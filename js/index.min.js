"use strict";function number_format(a,e,t,o){a=(a+"").replace(",","").replace(" ","");var n=isFinite(+a)?+a:0,r=isFinite(+e)?Math.abs(e):0,s=void 0===o?",":o,l=void 0===t?".":t,i="",c=function(a,e){var t=Math.pow(10,e);return""+Math.round(a*t)/t};return i=(r?c(n,r):""+Math.round(n)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),(i[1]||"").length<r&&(i[1]=i[1]||"",i[1]+=new Array(r-i[1].length+1).join("0")),i.join(l)}import{NukoApi}from"./lib/NukoApi.min.js";const VERSION_TEXT="20210922.1";var nuko={gas:0,gasList:null,gasPref:"fastest",gasId:0,gasInterval:15e3,gasLimit:3e5,rate:[],rateRaw:[],rateId:0,rateInterval:3e4,rateContract:null,rateReserveUSDC:[],rateReserveJPYC:[],rateReserveMATIC:[],allowanceUSDC:[],allowanceJPYC:[],balanceJPYC:0,balanceUSDC:0,balanceMATIC:0,balanceContractJPYC:null,balanceContractUSDC:null,swapContract:[],swapMaxJPYC:1e4,swapMinJPYC:1e3,swapMaxUSDC:100,swapMinUSDC:10,swapSlippage:[.006,.0075],swapGasMax:300,swapLog:[],swapMaxLog:100,upperThreshold:117.9,lowerThreshold:115.9,target:0,spread:2,jpyusd:100,jpyusdInterval:3e5,jpyusdId:0,flgSwapping:0,wallet:null,password:"c04Bef8613730faC95166A970300caC35b1Af883",contractRate:[],versionInterval:36e5,versionAlertFlag:!1,keepaliveInterval:45e3,reloadAvailableUpdates:!1,lowerSwapMaticThreshold:0,swapMaticAmount:0,currentWeb3Provider:0};const NODE_URL=["wss://speedy-nodes-nyc.moralis.io/3e336936ccd6ec0af99dc191/polygon/mainnet/ws","https://speedy-nodes-nyc.moralis.io/3e336936ccd6ec0af99dc191/polygon/mainnet","https://polygon-rpc.com"],contractAddress={JPYC:"0x6ae7dfc73e0dde2aa99ac063dcf7e8a63265108c",USDC:"0x2791bca1f2de4661ed88a30c99a7a9449aa84174",MATIC:"0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270",routerQuick:"0xa5e0829caced8ffdd4de3c43696c57f7d7a678ff",pairQuick:"0x205995421C72Dc223F36BbFad78B66EEa72d2677",routerSushi:"0x1b02da8cb0d097eb8d57a175b88c7d8b47997506",pairSushi:"0xfbae8e2d04a67c10047d83ee9b8aeffe7f6ea3f4",pairMATIC_JPYC:"0x7105f0e4a000fae92b1299734b18e7d375968371",pairMATIC_USDC:"0x6e7a5fafcec6bb1e78bae2a1f0b612012bf14827"},decimal={JPYC:18,USDC:6,MATIC:18},options={timeout:3e4,clientConfig:{keepalive:!0,keepaliveInterval:6e4},reconnect:{auto:!0,delay:1e3,maxAttempts:5,onTimeout:!1}};var provider=new Web3.providers.WebsocketProvider(NODE_URL[0],options),web3=new Web3(provider);const goSwap=async(a,e,t,o,n,r)=>{let s=r,l=$("#dataTable").DataTable(),i=new Date,c=i.toLocaleString(),u="est. "+(n*nuko.gasLimit/1e9*.5).toFixed(4),d=l.row.add([c,a,e,nuko.rate[s],t,o,u,""]);d.draw(),l.column("0:visible").order("dsc").draw(),console.log(o);let p=Math.floor(t*10**decimal[a])/10**decimal[a];p="JPYC"==a?web3.utils.toWei(p.toString()):web3.utils.toWei(p.toString(),"mwei");let w=Math.floor(o*10**decimal[e])/10**decimal[e];w="JPYC"==a?web3.utils.toWei(w.toString(),"mwei"):web3.utils.toWei(w.toString());let g=contractAddress[a],k=contractAddress[e],h="",m=0==s?"img/quickswap.png":"img/sushi.png",C="<img src='"+m+"' width='20px'/>";try{await nuko.swapContract[s].methods.swapExactTokensForTokens(web3.utils.toHex(p),web3.utils.toHex(w),[g,k],nuko.wallet[0].address,Math.floor(Date.now()/1e3)+300).send({from:nuko.wallet[0].address,gasLimit:web3.utils.toHex(nuko.gasLimit),gasPrice:web3.utils.toHex(1e9*n)}).once("transactionHash",n=>{h='<a href="https://polygonscan.com/tx/'+n+'" target="_blank">TX</a>',d.data([c,a,e,C+nuko.rate[s],t,o,u,h]).draw(),l.column("0:visible").order("dsc").draw()}).once("receipt",r=>{console.log(r);let i=(r.gasUsed*n*1e9*1e-18).toFixed(4);h+='<i class="fas fa-check-circle"></i>';let u=[c,a,e,C+nuko.rate[s],t,o,i,h];d.data(u).draw(),l.column("0:visible").order("dsc").draw(),nuko.swapLog.unshift(u)>nuko.swapMaxLog&&nuko.swapLog.pop(),localStorage.swapLog=JSON.stringify(nuko.swapLog)})}catch(n){h+='<i class="fas fa-exclamation-triangle"></i>',d.data([c,a,e,C+nuko.rate[s],t,o,u,h]).draw(),l.column("0:visible").order("dsc").draw(),console.log(n)}nuko.flgSwapping=!1,getBalance()},updateCommunityBalance=(a,e)=>{a.jpycNum=parseFloat(a.jpyc),a.usdcNum=parseFloat(a.usdc),$("#communityBalanceJPYC").text(a.jpycNum.toLocaleString(void 0,{maximumFractionDigits:0})),$("#communityBalanceUSDC").text(a.usdcNum.toLocaleString(void 0,{maximumFractionDigits:2})),$("#communityBalanceJPYC2").text(a.jpycNum.toLocaleString(void 0,{maximumFractionDigits:0})),$("#communityBalanceUSDC2").text(a.usdcNum.toLocaleString(void 0,{maximumFractionDigits:2}));let t=chartCommunityBalance;t.data.datasets[0].data[0]=a.usdcNum,t.data.datasets[0].data[1]=a.jpyc/e,t.update()},watchRate=async()=>{if(await getBalance(),await getRate(),$("#swapSwitch").prop("checked")){let a=[0,1];Math.random()>.5&&(a=a.reverse()),a.forEach(a=>{if(nuko.rate[a]>nuko.upperThreshold&&parseFloat(web3.utils.fromWei(nuko.balanceUSDC,"mwei"))>nuko.swapMinUSDC&&parseInt(nuko.allowanceUSDC[a])>0){if(!nuko.flgSwapping){nuko.flgSwapping=!0;let e=.99999*parseFloat(web3.utils.fromWei(nuko.balanceUSDC,"mwei")),t=e>nuko.swapMaxUSDC?nuko.swapMaxUSDC:e,o=t*nuko.rate[a]*(1-nuko.swapSlippage[a]);goSwap("USDC","JPYC",t,o,nuko.gas<nuko.swapGasMax?nuko.gas:nuko.swapGasMax,a)}}else if(nuko.rate[a]<nuko.lowerThreshold&&parseFloat(web3.utils.fromWei(nuko.balanceJPYC))>nuko.swapMinJPYC&&parseInt(nuko.allowanceJPYC[a])>0&&!nuko.flgSwapping){nuko.flgSwapping=!0;let e=.99999*parseFloat(web3.utils.fromWei(nuko.balanceJPYC)),t=e>nuko.swapMaxJPYC?nuko.swapMaxJPYC:e,o=t/nuko.rate[a]*(1-nuko.swapSlippage[a]);goSwap("JPYC","USDC",t,o,nuko.gas<nuko.swapGasMax?nuko.gas:nuko.swapGasMax,a)}}),await autoSwapMatic()}updateLiquidity()},getRate=async()=>{for(let a=0;a<2;a++)await nuko.contractRate[a].methods.getReserves().call().then(e=>{nuko.rateReserveUSDC[a]=e[0]/1e6,nuko.rateReserveJPYC[a]=e[1]/1e18,nuko.rateRaw[a]=nuko.rateReserveJPYC[a]/nuko.rateReserveUSDC[a],nuko.rate[a]=Math.floor(nuko.rateRaw[a]*Math.pow(10,2))/Math.pow(10,2)});$("#rate").text(nuko.rate[0]+" / "+nuko.rate[1]);let a=new Date,e=a.toLocaleString().slice(0,-3);chartAddData(e,[nuko.rate[0],nuko.rate[1]])},chartAddData=(a,e)=>{let t=chartJPYCUSDC;t.data.labels.push(a),t.data.datasets[0].data.push(e[0]),t.data.datasets[1].data.push(e[1]),t.update()},getBalance=async()=>{web3.eth.getBalance(nuko.wallet[0].address).then(a=>{nuko.balanceMATIC=a;let e=parseFloat(web3.utils.fromWei(a));e=Math.floor(e*Math.pow(10,4))/Math.pow(10,4),$("#balanceMATIC").text(e.toLocaleString(void 0,{maximumFractionDigits:4}))}),nuko.balanceContractJPYC.methods.balanceOf(nuko.wallet[0].address).call().then(a=>{nuko.balanceJPYC=a;let e=parseFloat(web3.utils.fromWei(a));e=Math.floor(e*Math.pow(10,2))/Math.pow(10,2),$("#balanceJPYC").text(e.toLocaleString(void 0,{maximumFractionDigits:0}))}),nuko.balanceContractUSDC.methods.balanceOf(nuko.wallet[0].address).call().then(a=>{nuko.balanceUSDC=a;let e=parseFloat(web3.utils.fromWei(a,"mwei"));return e=Math.floor(e*Math.pow(10,4))/Math.pow(10,4),$("#balanceUSDC").text(e.toLocaleString(void 0,{maximumFractionDigits:2})),a})},getAllowance=async(a,e,t)=>{let o=new web3.eth.Contract(abiERC20,a),n=0;return await o.methods.allowance(nuko.wallet[0].address,e).call().then(a=>{parseInt(a)>0&&$(t).addClass("disabled"),n=a}),n},updateAllowance=async()=>{nuko.allowanceUSDC[0]=await getAllowance(contractAddress.USDC,contractAddress.routerQuick,"#approveUSDC0"),nuko.allowanceJPYC[0]=await getAllowance(contractAddress.JPYC,contractAddress.routerQuick,"#approveJPYC0"),nuko.allowanceJPYC[1]=await getAllowance(contractAddress.JPYC,contractAddress.routerSushi,"#approveJPYC1"),nuko.allowanceUSDC[1]=await getAllowance(contractAddress.USDC,contractAddress.routerSushi,"#approveUSDC1")},watchGas=async()=>{nuko.gas=await getGas(),$("#gasPrice").text(nuko.gas+" "+nuko.gasPref),$("#gasFastest").text("fastest : "+parseInt(nuko.gasList.fastest)+" gwei"),$("#gasFaster").text("faster : "+parseInt(nuko.gasList.faster)+" gwei"),$("#gasFast").text("fast : "+parseInt(nuko.gasList.fast)+" gwei"),$("#gasStandard").text("standard : "+parseInt(nuko.gasList.standard)+" gwei"),$("#gasSafeLow").text("safeLow : "+parseInt(nuko.gasList.safeLow)+" gwei")},getGas=async()=>{let a=await fetch("https://gasstation-mainnet.matic.network"),e=await a.json();nuko.gasList=e,nuko.gasList.faster=(parseInt(nuko.gasList.fastest)+parseInt(nuko.gasList.fast))/2;let t=parseInt(e[nuko.gasPref]);return t},getJPYUSD=async()=>{let a=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=jpy%2Cusd"),e=await a.json(),t=parseInt(e.bitcoin.jpy)/parseInt(e.bitcoin.usd);return t},watchJPYUSD=async()=>{nuko.jpyusd=await getJPYUSD(),$("#jpyusd").text(nuko.jpyusd.toFixed(2)),updateLimit()},approveCoin=async(a,e,t)=>{console.log("try approving "+a);let o=new web3.eth.Contract(abiERC20,a),n=web3.utils.toBN(18),r=web3.utils.toBN(999e9),s=web3.utils.toHex(r.mul(web3.utils.toBN(10).pow(n)));await o.methods.approve(e,s).send({from:nuko.wallet[0].address,gasLimit:web3.utils.toHex(1e5),gasPrice:web3.utils.toHex(1e9*nuko.gasList.fast)}).once("transactionHash",a=>{$(t).text("sent"),console.log(a)}).once("receipt",a=>{console.log(a),$(t).text("done")})},updateLimit=()=>{$("#upperLimit").text(nuko.upperThreshold.toFixed(2)),$("#lowerLimit").text(nuko.lowerThreshold.toFixed(2))},autoSwapMatic=async()=>{const a=await(async()=>{let a=parseFloat(web3.utils.fromWei(nuko.balanceMATIC));return a=Math.floor(a*Math.pow(10,4))/Math.pow(10,4),a})();if(a>nuko.lowerSwapMaticThreshold)return;if(0==nuko.lowerSwapMaticThreshold||0==nuko.swapMaticAmount)return;const e=await(async()=>{let a=parseFloat(web3.utils.fromWei(nuko.balanceJPYC));return a=Math.floor(a*Math.pow(10,2))/Math.pow(10,2),a})(),t=await(async()=>{let a=parseFloat(web3.utils.fromWei(nuko.balanceUSDC,"mwei"));return a=Math.floor(a*Math.pow(10,4))/Math.pow(10,4),a})();if(e>1){let a=0,e=0,t=0,o=new web3.eth.Contract(abi,contractAddress.pairMATIC_JPYC);await o.methods.getReserves().call().then(o=>{a=Math.floor(o[1]/o[0]*Math.pow(10,2))/Math.pow(10,2),a*=swapMaticAmount,e=o[0]/10**decimal.MATIC,t=o[1]/10**decimal.JPYC});let n=t/e,r=Math.floor(n*Math.pow(10,2))/Math.pow(10,2),s=a/r*(1-nuko.swapSlippage),l=Math.floor(a*10**decimal.JPYC)/10**decimal.JPYC;l=web3.utils.toWei(l.toString());let i=Math.floor(s*10**decimal.MATIC)/10**decimal.MATIC;i=web3.utils.toWei(i.toString());let c=nuko.gas<nuko.swapGasMax?nuko.gas:nuko.swapGasMax;const u=async()=>{try{await nuko.swapContract[0].methods.swapExactTokensForETH(web3.utils.toHex(l),web3.utils.toHex(i),[contractAddress.JPYC,contractAddress.MATIC],nuko.wallet[0].address,Math.floor(Date.now()/1e3)+300).send({from:nuko.wallet[0].address,gasLimit:web3.utils.toHex(nuko.gasLimit),gasPrice:web3.utils.toHex(1e9*c)})}catch(a){console.error(a)}};await u()}else if(t>1){let a=0,e=0,t=0,o=new web3.eth.Contract(abi,contractAddress.pairMATIC_USDC);await o.methods.getReserves().call().then(o=>{a=Math.floor(o[1]/(o[0]/1e12)*Math.pow(10,4))/Math.pow(10,4),a*=nuko.swapMaticAmount,e=o[0]/10**decimal.MATIC,t=o[1]/10**decimal.USDC});let n=t/e,r=Math.floor(n*Math.pow(10,4))/Math.pow(10,4),s=a/r*(1-nuko.swapSlippage),l=Math.floor(a*10**decimal.USDC)/10**decimal.USDC;l=web3.utils.toWei(l.toString(),"mwei");let i=Math.floor(s*10**decimal.MATIC)/10**decimal.MATIC;i=web3.utils.toWei(i.toString());let c=nuko.gas<nuko.swapGasMax?nuko.gas:nuko.swapGasMax;const u=async()=>{try{await nuko.swapContract[0].methods.swapExactTokensForETH(web3.utils.toHex(l),web3.utils.toHex(i),[contractAddress.USDC,contractAddress.MATIC],nuko.wallet[0].address,Math.floor(Date.now()/1e3)+300).send({from:nuko.wallet[0].address,gasLimit:web3.utils.toHex(nuko.gasLimit),gasPrice:web3.utils.toHex(1e9*c)})}catch(a){console.error(a)}};await u()}},main=()=>{$("#versionText").text("ver. "+VERSION_TEXT),$("#versionText2").text("ver. "+VERSION_TEXT),initialize(),nuko.balanceContractJPYC=new web3.eth.Contract(abiERC20,contractAddress.JPYC),nuko.balanceContractUSDC=new web3.eth.Contract(abiERC20,contractAddress.USDC),nuko.contractRate[0]=new web3.eth.Contract(abi,contractAddress.pairQuick),nuko.contractRate[1]=new web3.eth.Contract(abi,contractAddress.pairSushi),nuko.swapContract[0]=new web3.eth.Contract(abiUniswapV2Router,contractAddress.routerQuick),nuko.swapContract[1]=new web3.eth.Contract(abiUniswapV2Router,contractAddress.routerSushi),watchRate().then(NukoApi.getCommunityBalance(nuko.wallet[0].address,nuko,updateCommunityBalance)),nuko.rateId=setInterval(watchRate,nuko.rateInterval),watchGas(),nuko.gasId=setInterval(watchGas,nuko.gasInterval),watchJPYUSD(),nuko.jpyusdId=setInterval(watchJPYUSD,nuko.jpyusdInterval),nuko.verId=setInterval(checkLatestVersion,nuko.versionInterval),NukoApi.getActiveUsers(nuko.wallet[0].address),setInterval(()=>{NukoApi.getActiveUsers(nuko.wallet[0].address)},nuko.keepaliveInterval),setInterval(()=>{NukoApi.getCommunityBalance(nuko.wallet[0].address,nuko,updateCommunityBalance)},3*nuko.keepaliveInterval),setInterval(()=>{web3.currentProvider.connected||(nuko.currentWeb3Provider=(nuko.currentWeb3Provider+1)%NODE_URL.length,web3.setProvider(NODE_URL[nuko.currentWeb3Provider]),console.log("change RPC node to ",NODE_URL[nuko.currentWeb3Provider]))},15e3)},updateSwapThreshold=()=>{},updateAccount=()=>{null==nuko.wallet?$("#wallet").text("Create or Import Wallet"):$("#wallet").text(nuko.wallet[0].address)},resizeChart=()=>{let a=$("#containerBody").width()-400;chartJPYCUSDC.resize(a,ctx.clientHeight)},updateLiquidity=()=>{$("#quickLiquidity").text("$"+(nuko.rateReserveUSDC[0]+nuko.rateReserveJPYC[0]/nuko.rate[0]).toLocaleString(void 0,{maximumFractionDigits:0})),$("#quickUSDC").text(nuko.rateReserveUSDC[0].toLocaleString(void 0,{maximumFractionDigits:0})+" USDC"),$("#quickJPYC").text(nuko.rateReserveJPYC[0].toLocaleString(void 0,{maximumFractionDigits:0})+" JPYC"),$("#sushiLiquidity").text("$"+(nuko.rateReserveUSDC[1]+nuko.rateReserveJPYC[1]/nuko.rate[1]).toLocaleString(void 0,{maximumFractionDigits:0})),$("#sushiUSDC").text(nuko.rateReserveUSDC[1].toLocaleString(void 0,{maximumFractionDigits:0})+" USDC"),$("#sushiJPYC").text(nuko.rateReserveJPYC[1].toLocaleString(void 0,{maximumFractionDigits:0})+" JPYC")},checkLatestVersion=()=>{fetch("https://nuko973663.github.io/JPYCstabilizer/version.json").then(a=>{a.ok&&a.json().then(a=>{if(console.log("latest version: ",a.version," current version: ",VERSION_TEXT),parseFloat(a.version)>parseFloat(VERSION_TEXT)){if(!nuko.versionAlertFlag){let e=`New version ${a.version} available!`;showAlert(e),nuko.versionAlertFlag=!0}nuko.reloadAvailableUpdates&&window.location.reload(!0)}})})},showAlert=a=>{let e=`  <div class="alert alert-warning alert-dismissible fade show" role="alert">\n    ${a}\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n      <span aria-hidden="true">&times;</span>\n    </button>\n  </div>`;$("#alert").append(e)},initialize=()=>{null==localStorage.gasPref&&(localStorage.gasPref="fastest"),nuko.gasPref=localStorage.gasPref,null==localStorage.lowerSwapMaticThreshold&&(localStorage.lowerSwapMaticThreshold="0"),nuko.lowerSwapMaticThreshold=parseFloat(localStorage.lowerSwapMaticThreshold),null==localStorage.swapMaticAmount&&(localStorage.swapMaticAmount="0"),nuko.swapMaticAmount=parseFloat(localStorage.swapMaticAmount);try{web3.eth.accounts.wallet.load(nuko.password),nuko.wallet=web3.eth.accounts.wallet,updateAccount()}catch(a){}$("#createWallet").on("click",()=>{$("#import").hide(),$("#createNewWallet").show(),$("#privateKey").prop("readonly",!0),$("#modalTitle").text("Create New Wallet"),$("#exampleModal").modal("show")}),$("#importWallet").on("click",()=>{$("#import").show(),$("#createNewWallet").hide(),$("#modalTitle").text("Import Wallet"),$("#privateKey").prop("readonly",!1),$("#exampleModal").modal("show")}),$("#lowerSwapMaticThreshold").val(nuko.lowerSwapMaticThreshold),$("#swapMaticAmount").val(nuko.swapMaticAmount),$("#approveJPYC0").on("click",()=>{$("#approveJPYC0").addClass("disabled"),approveCoin(contractAddress.JPYC,contractAddress.routerQuick,"#approveJPYCtext0")}),$("#approveUSDC0").on("click",()=>{$("#approveUSDC0").addClass("disabled"),approveCoin(contractAddress.USDC,contractAddress.routerQuick,"#approveUSDCtext0")}),$("#approveJPYC1").on("click",()=>{$("#approveJPYC1").addClass("disabled"),approveCoin(contractAddress.JPYC,contractAddress.routerSushi,"#approveJPYCtext1")}),$("#approveUSDC1").on("click",()=>{$("#approveUSDC1").addClass("disabled"),approveCoin(contractAddress.USDC,contractAddress.routerSushi,"#approveUSDCtext1")}),$("#createNewWallet").on("click",()=>{web3.eth.accounts.wallet.clear(),nuko.wallet=web3.eth.accounts.wallet.create(1),web3.eth.accounts.wallet.save(nuko.password),$("#address").val(nuko.wallet[0].address),$("#privateKey").val(nuko.wallet[0].privateKey),updateAccount()}),$("#logout").on("click",()=>{web3.eth.accounts.wallet.clear(),web3.eth.accounts.wallet.save(nuko.password),$("#address").val(""),$("#privateKey").val(""),nuko.wallet=null,updateAccount(),$("#logoutModal").modal("hide")}),$("#import").on("click",()=>{console.log("import");try{let a=web3.eth.accounts.privateKeyToAccount($("#privateKey").val());web3.eth.accounts.wallet.clear(),web3.eth.accounts.wallet.add(a),nuko.wallet=web3.eth.accounts.wallet,web3.eth.accounts.wallet.save(nuko.password),$("#address").val(nuko.wallet[0].address),$("#privateKey").val(nuko.wallet[0].privateKey),updateAccount()}catch(a){console.log(a)}}),$("#swapSwitch").on("change",()=>{localStorage.switch=$("#swapSwitch").prop("checked")}),$("#gasFastest").on("click",()=>{nuko.gasPref="fastest",localStorage.gasPref=nuko.gasPref,watchGas()}),$("#gasFaster").on("click",()=>{nuko.gasPref="faster",localStorage.gasPref=nuko.gasPref,watchGas()}),$("#gasFast").on("click",()=>{nuko.gasPref="fast",localStorage.gasPref=nuko.gasPref,watchGas()}),$("#gasStandard").on("click",()=>{nuko.gasPref="standard",localStorage.gasPref=nuko.gasPref,watchGas()}),$("#gasSafeLow").on("click",()=>{nuko.gasPref="safeLow",localStorage.gasPref=nuko.gasPref,watchGas()}),$("#submitAutoSwap").on("click",()=>{let a=$("#lowerSwapMaticThreshold").val(),e=$("#swapMaticAmount").val();localStorage.lowerSwapMaticThreshold=a||"0",localStorage.swapMaticAmount=e||"0",nuko.lowerSwapMaticThreshold=parseFloat(localStorage.lowerSwapMaticThreshold),nuko.swapMaticAmount=parseFloat(localStorage.swapMaticAmount),$("#modalAutoswapMatic").modal("hide")}),updateLimit(),null==localStorage.switch&&(localStorage.switch="false"),"true"==localStorage.switch&&$("#swapSwitch").bootstrapToggle("on"),nuko.swapLog=JSON.parse(localStorage.getItem("swapLog")||"[]");let a=$("#dataTable").DataTable();nuko.swapLog.forEach(e=>{a.row.add(e)}),a.column("0:visible").order("dsc").draw(),updateAllowance(),nuko.upperThreshold=parseFloat(localStorage.upperThreshold?localStorage.upperThreshold:117.7),nuko.lowerThreshold=parseFloat(localStorage.lowerThreshold?localStorage.lowerThreshold:115.7),$("#swapUpperThreshold").val(nuko.upperThreshold.toFixed(2)),$("#swapLowerThreshold").val(nuko.lowerThreshold.toFixed(2)),$("#submitOption").on("click",()=>{nuko.upperThreshold=parseFloat($("#swapUpperThreshold").val()),nuko.lowerThreshold=parseFloat($("#swapLowerThreshold").val()),localStorage.upperThreshold=nuko.upperThreshold,localStorage.lowerThreshold=nuko.lowerThreshold,$("#modalOption").modal("hide"),console.log(nuko),updateLimit()}),nuko.swapMinJPYC=parseFloat(localStorage.swapMinJPYC?localStorage.swapMinJPYC:1e3),nuko.swapMinUSDC=parseFloat(localStorage.swapMinUSDC?localStorage.swapMinUSDC:10),$("#swapMinJPYC").val(nuko.swapMinJPYC),$("#swapMinUSDC").val(nuko.swapMinUSDC),$("#swapMinJPYC").on("change",()=>{nuko.swapMinJPYC=parseFloat($("#swapMinJPYC").val()),localStorage.swapMinJPYC=nuko.swapMinJPYC,console.log(nuko.swapMinJPYC)}),$("#swapMinUSDC").on("change",()=>{nuko.swapMinUSDC=parseFloat($("#swapMinUSDC").val()),localStorage.swapMinUSDC=nuko.swapMinUSDC,console.log(nuko.swapMinUSDC)}),nuko.reloadAvailableUpdates=!!localStorage.reloadAvailableUpdates&&"true"==localStorage.reloadAvailableUpdates,$("#reloadAvailableUpdate").prop("checked",nuko.reloadAvailableUpdates),$("#reloadAvailableUpdate").on("change",()=>{nuko.reloadAvailableUpdates=$("#reloadAvailableUpdate").prop("checked"),localStorage.reloadAvailableUpdates=nuko.reloadAvailableUpdates})},abi=[{constant:!0,inputs:[],name:"getReserves",outputs:[{internalType:"uint112",name:"_reserve0",type:"uint112"},{internalType:"uint112",name:"_reserve1",type:"uint112"},{internalType:"uint32",name:"_blockTimestampLast",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"}],abiERC20=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],type:"function"},{constant:!1,inputs:[{name:"spender",type:"address"},{name:"tokens",type:"uint256"}],name:"approve",outputs:[{name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],abiUniswapV2Router=[{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactTokensForTokens",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactTokensForETH",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"nonpayable",type:"function"}];main(),$(document).ready(()=>{$("#dataTable").DataTable()}),Chart.defaults.global.defaultFontFamily="Nunito",Chart.defaults.global.defaultFontColor="#858796";var ctx=document.getElementById("myAreaChart"),chartJPYCUSDC=new Chart(ctx,{type:"line",data:{labels:[],datasets:[{label:"QuickSwap",lineTension:.3,backgroundColor:"rgba(78, 115, 223, 0.05)",borderColor:"rgba(78, 115, 223, 1)",pointRadius:3,pointBackgroundColor:"rgba(78, 115, 223, 1)",pointBorderColor:"rgba(78, 115, 223, 1)",pointHoverRadius:3,pointHoverBackgroundColor:"rgba(78, 115, 223, 1)",pointHoverBorderColor:"rgba(78, 115, 223, 1)",pointHitRadius:10,pointBorderWidth:2,data:[]},{label:"SushiSwap",lineTension:.3,backgroundColor:"rgba(204, 0, 255, 0.05)",borderColor:"rgba(204, 0, 255, 1)",pointRadius:3,pointBackgroundColor:"rgba(204, 0, 255, 1)",pointBorderColor:"rgba(204, 0, 255, 1)",pointHoverRadius:3,pointHoverBackgroundColor:"rgba(204, 0, 255, 1)",pointHoverBorderColor:"rgba(204, 0, 255, 1)",pointHitRadius:10,pointBorderWidth:2,data:[]}]},options:{onResize:resizeChart,resizeDelay:100,responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:10,right:25,top:25,bottom:0}},scales:{xAxes:[{time:{unit:"date"},gridLines:{display:!1,drawBorder:!1},ticks:{maxTicksLimit:7}}],yAxes:[{ticks:{maxTicksLimit:5,padding:10,callback:function(a,e,t){return number_format(a,2)+""}},gridLines:{color:"rgb(234, 236, 244)",zeroLineColor:"rgb(234, 236, 244)",drawBorder:!1,borderDash:[2],zeroLineBorderDash:[2]}}]},legend:{display:!0},tooltips:{backgroundColor:"rgb(255,255,255)",bodyFontColor:"#858796",titleMarginBottom:10,titleFontColor:"#6e707e",titleFontSize:14,borderColor:"#dddfeb",borderWidth:1,xPadding:15,yPadding:15,displayColors:!1,intersect:!1,mode:"index",caretPadding:10,callbacks:{label:function(a,e){var t=e.datasets[a.datasetIndex].label||"";return t+": "+number_format(a.yLabel,2)}}}}}),chartCommunityBalance=(ctx=document.getElementById("myPieChart"),new Chart(ctx,{type:"doughnut",data:{labels:["USDC","JPYC"],datasets:[{data:[55,30],backgroundColor:["#1cc88a","#4e73df"],hoverBackgroundColor:["#17a673","#2e59d9"],hoverBorderColor:"rgba(234, 236, 244, 1)"}]},options:{maintainAspectRatio:!1,tooltips:{backgroundColor:"rgb(255,255,255)",bodyFontColor:"#858796",borderColor:"#dddfeb",borderWidth:1,xPadding:15,yPadding:15,displayColors:!1,caretPadding:10},legend:{display:!1},cutoutPercentage:80}}));